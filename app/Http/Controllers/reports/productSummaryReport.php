<?php
 namespace App\Http\Controllers\reports; use App\Http\Controllers\Controller; use App\Models\products; use App\Models\sale_details; use Illuminate\Http\Request; class productSummaryReport extends Controller { public function index() { $topProducts = products::withSum("\x73\141\154\145\x44\x65\x74\x61\151\x6c\163", "\161\164\x79")->withSum("\163\x61\154\145\104\145\164\141\x69\154\x73", "\x74\x69")->orderByDesc("\163\x61\x6c\145\x5f\x64\x65\x74\x61\x69\154\163\x5f\x73\165\155\137\x71\x74\x79")->get(); $topProductsArray = array(); foreach ($topProducts as $product) { $stock = getStock($product->id); $price = avgSalePrice("\x61\154\x6c", "\x61\x6c\x6c", $product->id); $pprice = avgPurchasePrice("\141\154\x6c", "\x61\x6c\x6c", $product->id); $ppu = $price - $pprice; $profit = $ppu * $product->sale_details_sum_qty; $stockValue = $pprice * $stock; $topProductsArray[] = array("\x6e\141\x6d\145" => $product->name, "\x75\156\x69\164" => $product->unit->name, "\x75\156\151\164\126\x61\154\x75\145" => $product->unit->value, "\160\x72\151\x63\x65" => $price, "\160\x70\x72\x69\x63\145" => $pprice, "\x70\x72\x6f\x66\151\x74" => $profit, "\x73\164\x6f\x63\153" => $stock, "\x73\x74\x6f\x63\x6b\x56\141\x6c\165\x65" => $stockValue, "\x61\x6d\x6f\x75\x6e\164" => $product->sale_details_sum_ti, "\x73\x6f\x6c\144" => $product->sale_details_sum_qty); } return view("\162\145\160\157\162\164\x73\56\x70\x72\x6f\x64\165\x63\164\x53\x75\155\155\x61\162\171\x2e\144\x65\x74\x61\151\x6c\x73", compact("\164\157\160\120\x72\157\144\165\143\x74\163\101\x72\162\141\171")); } }
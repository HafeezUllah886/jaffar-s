<?php
 namespace App\Http\Controllers\reports; use App\Http\Controllers\Controller; use App\Models\sales; use Illuminate\Http\Request; use App\Models\User; class loadsheetController extends Controller { public function index() { $orderbookers = User::all(); return view("\162\145\x70\157\x72\x74\163\56\154\x6f\141\x64\x73\x68\x65\x65\164\x2e\x69\156\144\x65\170", compact("\x6f\x72\144\x65\x72\x62\x6f\x6f\x6b\145\x72\163")); } public function data($id, $date) { $sales = sales::whereDate("\144\x61\x74\x65", $date)->where("\157\x72\x64\145\162\142\157\157\153\145\162\x49\x44", $id)->with("\x64\x65\164\x61\x69\x6c\163")->get(); if ($sales->isEmpty()) { return back()->with("\145\x72\162\x6f\162", "\116\x6f\40\104\x61\164\x61\x20\106\157\x75\156\x64"); } $salesData = array("\x73\141\154\x65\x5f\x69\156\146\x6f" => $sales->map->toArray(), "\163\141\x6c\145\x5f\x64\x65\164\x61\151\154\x73" => array(), "\164\157\164\141\x6c\x5f\x73\141\x6c\145\x5f\x61\x6d\157\165\156\x74" => 0); $allProducts = array(); foreach ($sales as $sale) { $productSales = $sale->details->groupBy("\160\x72\157\144\165\x63\x74\111\x44"); foreach ($productSales as $productID => $saleDetails) { $totalQty = $saleDetails->sum("\161\164\x79"); $totalAmount = $saleDetails->sum("\x74\151"); if (!isset($allProducts[$productID])) { $product = $saleDetails->first()->product; $allProducts[$productID] = array("\160\162\x6f\144\165\x63\164\111\x44" => $productID, "\x6e\141\x6d\x65" => $product->name, "\x74\157\x74\x61\154\x5f\161\164\x79" => 0, "\x74\x6f\x74\x61\154\x5f\141\x6d\x6f\165\156\164" => 0, "\160\141\143\x6b\x5f\163\x69\x7a\x65" => $product->unit->value); } $allProducts[$productID]["\x74\x6f\164\141\x6c\x5f\161\x74\171"] += $totalQty; $allProducts[$productID]["\164\157\x74\141\154\x5f\x61\x6d\157\165\x6e\164"] += $totalAmount; } $salesData["\164\157\164\x61\154\137\163\141\x6c\145\137\141\x6d\x6f\165\x6e\x74"] += $sale->details->sum("\164\151"); $salesData["\157\x72\x64\145\x72\x62\x6f\157\153\145\x72"] = $sale->orderbooker->name; $salesData["\144\x61\x74\145"] = $sale->date; } $salesData["\x73\x61\x6c\145\x5f\144\x65\164\x61\151\154\x73"] = array_values($allProducts); return view("\162\145\160\x6f\162\164\163\56\x6c\x6f\x61\x64\163\150\x65\x65\x74\56\x64\145\x74\x61\151\154\x73", compact("\163\141\x6c\x65\163\104\x61\164\x61")); } }